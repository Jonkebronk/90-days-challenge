generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// NextAuth models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  password      String?
  image         String?
  role          String    @default("client") // "coach" or "client"
  status        String    @default("pending") // "pending", "active", "inactive"
  coachId       String?
  invitationToken String?  @unique
  invitationSentAt DateTime?
  inviteCode    String?   @unique // Golden ticket code (e.g., "GOLD-A7K9-2M4P")
  inviteCodeExpiresAt DateTime? // Code expiration date
  inviteCodeUsedAt DateTime? // When the code was used

  // Extended client info
  firstName     String?
  lastName      String?
  birthdate     DateTime?
  gender        String?
  phone         String?
  countryCode   String?
  country       String?
  language      String?
  tags          String[]
  membershipStartDate DateTime?
  membershipStatus String?
  checkInFrequency String?
  checkInPeriod String?
  checkInDay    String?

  createdAt     DateTime  @default(now())

  accounts      Account[]
  sessions      Session[]
  userProfile   UserProfile?
  nutritionPlan NutritionPlan?
  caloriePlan   CaloriePlan?
  mealPlan      MealPlan?   @relation("AssignedMealPlan")
  meals         Meal[]
  workoutPlan   WorkoutPlan?
  dailyLogs     DailyLog[]
  workoutLogs   WorkoutLog[]
  knowledgeProgress UserKnowledgeProgress[]
  checkIns      CheckIn[]
  lessonProgress LessonProgress[]
  articleProgress ArticleProgress[]
  recipeFavorites RecipeFavorite[]
  assignedWorkoutPrograms AssignedWorkoutProgram[]
  workoutSessionLogs WorkoutSessionLog[]

  // Coach-Client relationship
  coach         User?     @relation("CoachClients", fields: [coachId], references: [id])
  clients       User[]    @relation("CoachClients")

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// App models
model UserProfile {
  id                 String   @id @default(cuid())
  userId             String   @unique

  // Goals
  primaryGoal        String?  // "build_muscle", "get_fit", "healthy_habits"

  // Physiology
  heightCm           Decimal? @db.Decimal(5, 2)
  currentWeightKg    Decimal? @db.Decimal(5, 2)
  genderAtBirth      String?  // "male", "female", "other"
  activityLevelFree  String?  // "very_low", "low", "medium", "active", "very_active"
  activityLevelWork  String?  // "very_low", "low", "medium", "high"

  // Nutrition
  nutritionNotes     String?  // Free text about food preferences
  allergies          String[] // Array of allergies
  dietaryPreferences String[] // "pescetarian", "vegan", "vegetarian", "halal", "kosher", "no_supplements"
  excludedIngredients String[] // Array of ingredients to exclude
  nutritionMissing   String?  // Additional nutrition info

  // Activity
  trainingDays       String[] // ["MON", "TUE", etc]
  trainingExperience String?  // "beginner", "experienced", "very_experienced"
  trainingDetails    String?  // Details about training experience

  // Lifestyle
  lifestyleNotes     String?  // Final comments before finishing

  onboardingCompleted Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model NutritionPlan {
  id             String   @id @default(cuid())
  userId         String   @unique
  tdee           Decimal  @db.Decimal(7, 2)
  targetCalories Decimal  @db.Decimal(7, 2)
  proteinG       Decimal  @db.Decimal(6, 2)
  carbsG         Decimal  @db.Decimal(6, 2)
  fatG           Decimal  @db.Decimal(6, 2)
  currentPhase   Int      @default(1)
  startDate      DateTime @default(now())
  createdAt      DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("nutrition_plans")
}

model FoodItem {
  id                String   @id @default(cuid())
  name              String
  category          String?
  calories          Decimal  @db.Decimal(6, 2)
  proteinG          Decimal  @db.Decimal(5, 2)
  carbsG            Decimal  @db.Decimal(5, 2)
  fatG              Decimal  @db.Decimal(5, 2)
  isVegetarian      Boolean  @default(true)
  isVegan           Boolean  @default(false)
  commonServingSize String?

  mealIngredients   MealIngredient[]
  recipeIngredients RecipeIngredient[]
  mealPlanItems     MealPlanItem[]

  @@map("food_items")
}

model Meal {
  id             String   @id @default(cuid())
  userId         String
  name           String
  mealType       String?
  totalCalories  Decimal? @db.Decimal(7, 2)
  totalProteinG  Decimal? @db.Decimal(6, 2)
  totalCarbsG    Decimal? @db.Decimal(6, 2)
  totalFatG      Decimal? @db.Decimal(6, 2)
  isFavorite     Boolean  @default(false)
  createdAt      DateTime @default(now())

  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  ingredients MealIngredient[]
  mealLogs    MealLog[]

  @@map("meals")
}

model MealIngredient {
  id         String  @id @default(cuid())
  mealId     String
  foodItemId String
  amountG    Decimal @db.Decimal(7, 2)

  meal     Meal     @relation(fields: [mealId], references: [id], onDelete: Cascade)
  foodItem FoodItem @relation(fields: [foodItemId], references: [id])

  @@map("meal_ingredients")
}

model Exercise {
  id              String   @id @default(cuid())
  name            String
  category        String?  // "strength", "cardio", "flexibility", etc.
  muscleGroups    String[] // ["chest", "triceps", "shoulders"]
  equipmentNeeded String[] // ["barbell", "bench", "dumbbells"]
  difficultyLevel String?  // "beginner", "intermediate", "advanced"
  description     String?
  videoUrl        String?  // YouTube/Vimeo embed URL
  instructions    String[] // Step-by-step instructions
  thumbnailUrl    String?  // Exercise thumbnail image

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  sessionExercises        SessionExercise[]
  exerciseLogs            ExerciseLog[]
  workoutProgramExercises WorkoutProgramExercise[]
  workoutSetLogs          WorkoutSetLog[]          @relation("SetLogs")

  @@map("exercises")
}

model WorkoutPlan {
  id           String   @id @default(cuid())
  userId       String   @unique
  currentPhase Int      @default(1)
  currentWeek  Int      @default(1)

  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutSessions  WorkoutSession[]

  @@map("workout_plans")
}

model WorkoutSession {
  id                String  @id @default(cuid())
  workoutPlanId     String
  name              String
  dayOfWeek         Int?
  sessionType       String?
  estimatedDuration Int?

  workoutPlan      WorkoutPlan       @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)
  sessionExercises SessionExercise[]
  workoutLogs      WorkoutLog[]

  @@map("workout_sessions")
}

model SessionExercise {
  id                String @id @default(cuid())
  workoutSessionId  String
  exerciseId        String
  orderIndex        Int
  sets              Int
  reps              Int?
  restSeconds       Int    @default(60)

  workoutSession WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)
  exercise       Exercise       @relation(fields: [exerciseId], references: [id])

  @@map("session_exercises")
}

model DailyLog {
  id          String   @id @default(cuid())
  userId      String
  logDate     DateTime
  weightKg    Decimal? @db.Decimal(5, 2)
  energyLevel Int?
  sleepHours  Decimal? @db.Decimal(3, 1)
  notes       String?
  createdAt   DateTime @default(now())

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  mealLogs MealLog[]

  @@unique([userId, logDate])
  @@map("daily_logs")
}

model MealLog {
  id          String   @id @default(cuid())
  dailyLogId  String
  mealId      String
  mealTime    DateTime @default(now())

  dailyLog DailyLog @relation(fields: [dailyLogId], references: [id], onDelete: Cascade)
  meal     Meal     @relation(fields: [mealId], references: [id])

  @@map("meal_logs")
}

model WorkoutLog {
  id                String   @id @default(cuid())
  userId            String
  workoutSessionId  String?
  completedAt       DateTime @default(now())
  durationMinutes   Int?
  notes             String?

  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutSession  WorkoutSession? @relation(fields: [workoutSessionId], references: [id])
  exerciseLogs    ExerciseLog[]

  @@map("workout_logs")
}

model ExerciseLog {
  id            String  @id @default(cuid())
  workoutLogId  String
  exerciseId    String
  setNumber     Int
  reps          Int?
  weightKg      Decimal? @db.Decimal(5, 2)
  completed     Boolean @default(true)

  workoutLog WorkoutLog @relation(fields: [workoutLogId], references: [id], onDelete: Cascade)
  exercise   Exercise   @relation(fields: [exerciseId], references: [id])

  @@map("exercise_logs")
}

// New Workout Program System (inspired by workout.cool)
model WorkoutProgram {
  id          String   @id @default(cuid())
  coachId     String   // Coach who created this program
  name        String   // "Upper/Lower Split", "Full Body Beginner", etc.
  description String?  // Program description and goals
  difficulty  String?  // "beginner", "intermediate", "advanced"
  durationWeeks Int?   // Planned duration in weeks

  // Program settings
  published   Boolean  @default(false)
  isTemplate  Boolean  @default(true) // True for reusable templates

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  days        WorkoutProgramDay[]
  assignments AssignedWorkoutProgram[]

  @@map("workout_programs")
}

model WorkoutProgramDay {
  id                String   @id @default(cuid())
  workoutProgramId  String
  dayNumber         Int      // 1, 2, 3, etc. within the program
  name              String   // "Push Day", "Leg Day", "Upper Body", etc.
  description       String?  // Day description/focus
  isRestDay         Boolean  @default(false)

  orderIndex        Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  workoutProgram    WorkoutProgram @relation(fields: [workoutProgramId], references: [id], onDelete: Cascade)
  exercises         WorkoutProgramExercise[]
  sessionLogs       WorkoutSessionLog[]

  @@map("workout_program_days")
}

model WorkoutProgramExercise {
  id                    String   @id @default(cuid())
  workoutProgramDayId   String
  exerciseId            String

  // Exercise configuration
  sets                  Int      // Number of sets
  repsMin               Int?     // Minimum reps (e.g., 8)
  repsMax               Int?     // Maximum reps (e.g., 12) - displays as "8-12 reps"
  restSeconds           Int      @default(60) // Rest between sets
  tempo                 String?  // "3-0-1-0" tempo notation
  notes                 String?  // "Drop set", "Superset with X", etc.

  // Targeting (optional overrides)
  targetWeight          Decimal? @db.Decimal(5, 2) // Suggested weight in kg
  targetRPE             Int?     // Rate of Perceived Exertion (1-10)

  orderIndex            Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  workoutProgramDay     WorkoutProgramDay @relation(fields: [workoutProgramDayId], references: [id], onDelete: Cascade)
  exercise              Exercise @relation(fields: [exerciseId], references: [id])

  @@map("workout_program_exercises")
}

model AssignedWorkoutProgram {
  id                String    @id @default(cuid())
  userId            String    // Client assigned to this program
  workoutProgramId  String    // The program template
  coachId           String    // Coach who assigned it

  startDate         DateTime  @default(now())
  endDate           DateTime? // Optional end date
  active            Boolean   @default(true)

  // Progress tracking
  currentWeek       Int       @default(1)
  currentDayNumber  Int       @default(1)

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutProgram    WorkoutProgram @relation(fields: [workoutProgramId], references: [id], onDelete: Cascade)

  @@map("assigned_workout_programs")
}

model WorkoutSessionLog {
  id                    String   @id @default(cuid())
  userId                String   // Client who performed the workout
  workoutProgramDayId   String   // Which day of the program
  assignedProgramId     String?  // Link to assignment (optional)

  startedAt             DateTime @default(now())
  completedAt           DateTime?
  durationMinutes       Int?     // Actual workout duration
  completed             Boolean  @default(false)
  notes                 String?  // Post-workout notes

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user                  User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutProgramDay     WorkoutProgramDay @relation(fields: [workoutProgramDayId], references: [id])
  sets                  WorkoutSetLog[]

  @@map("workout_session_logs")
}

model WorkoutSetLog {
  id                        String   @id @default(cuid())
  workoutSessionLogId       String
  workoutProgramExerciseId  String?  // Link to program exercise (optional)
  exerciseId                String   // The exercise performed

  setNumber                 Int      // 1, 2, 3, etc.
  reps                      Int?     // Reps completed
  weightKg                  Decimal? @db.Decimal(5, 2) // Weight used
  timeSeconds               Int?     // For timed exercises (planks, etc.)
  distance                  Decimal? @db.Decimal(7, 2) // For cardio (meters, km)
  rpe                       Int?     // Rate of Perceived Exertion
  completed                 Boolean  @default(true)
  notes                     String?  // "Failed on last rep", "Too easy", etc.

  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  workoutSessionLog         WorkoutSessionLog @relation(fields: [workoutSessionLogId], references: [id], onDelete: Cascade)
  exercise                  Exercise @relation("SetLogs", fields: [exerciseId], references: [id])

  @@map("workout_set_logs")
}

model KnowledgeModule {
  id                String   @id @default(cuid())
  title             String
  slug              String   @unique
  phase             Int?
  weekNumber        Int?
  contentType       String?
  content           String?
  videoUrl          String?
  estimatedDuration Int?
  orderIndex        Int?

  userProgress UserKnowledgeProgress[]

  @@map("knowledge_modules")
}

model UserKnowledgeProgress {
  id          String    @id @default(cuid())
  userId      String
  moduleId    String
  completed   Boolean   @default(false)
  completedAt DateTime?

  user   User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  module KnowledgeModule @relation(fields: [moduleId], references: [id], onDelete: Cascade)

  @@unique([userId, moduleId])
  @@map("user_knowledge_progress")
}

model CheckIn {
  id                    String   @id @default(cuid())
  userId                String
  weekNumber            Int?     // Week number in the program

  // Check-in data
  statusUpdate          String?  // "Hur har du haft det sedan din senaste uppdatering?"
  weightKg              Decimal? @db.Decimal(5, 2)
  energyLevel           Int?     // 1-5 stars
  mood                  Int?     // 1-5 (sad to happy)
  dietPlanAdherence     Int?     // 1-5 stars (kostschema användning)
  workoutPlanAdherence  Int?     // 1-5 stars (träningsschema användning)
  sleepNotes            String?  // "Hur mycket sover du i genomsnitt per natt?"
  dailySteps            String?  // "Hur många steg tar du vanligtvis per dag?"

  // Progress photos
  photoFront            String?  // URL to front photo
  photoSide             String?  // URL to side photo
  photoBack             String?  // URL to back photo

  createdAt             DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("check_ins")
}

model Lead {
  id          String   @id @default(cuid())
  name        String
  email       String?
  phone       String?
  status      String   @default("new") // "new", "contacted", "in_dialog", "paused", "won", "lost"
  notes       String?
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("leads")
}

model File {
  id          String   @id @default(cuid())
  name        String
  description String?
  fileUrl     String
  fileType    String?  // "pdf", "image", "video", etc
  fileSize    Int?     // in bytes
  uploadedBy  String?  // coach id or name
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("files")
}

model Lesson {
  id          String   @id @default(cuid())
  title       String
  description String?
  phase       Int?     // 1, 2, or 3 (Fas 1: 1-30, Fas 2: 31-60, Fas 3: 61-90)
  orderIndex  Int      @default(0) // Order within phase
  coverImage  String?  // URL to cover image

  // Publishing
  published   Boolean  @default(false)
  publishedAt DateTime?

  // Prerequisites (lessons that must be completed first)
  prerequisiteIds String[] // Array of lesson IDs

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  slides      Slide[]
  progress    LessonProgress[]

  @@map("lessons")
}

model Slide {
  id          String   @id @default(cuid())
  lessonId    String
  type        String   // "MDX_SLIDE", "VIDEO", "QUIZ", "DOCUMENT"
  title       String?
  content     String?  // MDX content for slides, question for quiz
  videoUrl    String?  // YouTube/Vimeo embed URL
  documentUrl String?  // URL to Word/PDF document
  orderIndex  Int      @default(0)

  // Quiz-specific fields (not saved in database)
  quizOptions Json?    // Quiz options if type is QUIZ

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  lesson      Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@map("slides")
}

model LessonProgress {
  id              String    @id @default(cuid())
  userId          String
  lessonId        String
  completed       Boolean   @default(false)
  completedAt     DateTime?
  lastSlideIndex  Int       @default(0) // Last slide viewed

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  lesson          Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
  @@map("lesson_progress")
}

model CaloriePlan {
  id                    String   @id @default(cuid())
  userId                String   @unique

  // Basic calculations
  weight                Decimal? @db.Decimal(5, 2)
  activityLevel         String?  // "25", "30", "35"
  deficit               Int?     // Calorie deficit per day
  dailySteps            Int?     // Number of steps per day

  // Macro settings
  proteinPerKg          Decimal? @db.Decimal(3, 1) // e.g., 2.0
  fatPerKg              Decimal? @db.Decimal(3, 1) // e.g., 0.7

  // Meal distribution
  numMeals              Int?     // Number of meals per day
  customDistribution    Boolean  @default(false)
  mealCalories          Int[]    // Array of calories per meal

  // Custom macros per meal (stored as JSON)
  customMacros          Json?    // [{protein: 50, fat: 20, carbs: 100}, ...]

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("calorie_plans")
}

// Article Bank and 90-Day Roadmap Models
model ArticleCategory {
  id          String   @id @default(cuid())
  name        String
  description String?
  slug        String   @unique
  color       String   @default("#FFD700") // Hex color for category accent
  section     String?  // Section/group name for organizing categories (e.g., "INNAN DU BÖRJAR", "GENOMGÅNG AV 90 DAGARS CHALLENGEN")
  orderIndex  Int      @default(0) // For sorting categories

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  articles    Article[]

  @@map("article_categories")
}

model Article {
  id                      String   @id @default(cuid())
  title                   String
  content                 String   // Rich text/MDX content
  slug                    String   @unique
  categoryId              String
  tags                    String[] // Additional tags for filtering
  difficulty              String?  // "beginner", "intermediate", "advanced"
  phase                   Int?     // 1 (days 1-30), 2 (days 31-60), 3 (days 61-90)
  estimatedReadingMinutes Int?     // How long it takes to read
  coverImage              String?  // URL to cover image
  orderIndex              Int      @default(0) // For sorting articles within category

  // Publishing
  published               Boolean  @default(false)
  publishedAt             DateTime?

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  category                ArticleCategory      @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  roadmapAssignments      RoadmapAssignment[]
  progress                ArticleProgress[]

  @@map("articles")
}

model RoadmapAssignment {
  id                    String   @id @default(cuid())
  articleId             String
  dayNumber             Int      // 1-90 (which day of the journey)
  phase                 Int      // 1, 2, or 3 (calculated from dayNumber)
  orderIndex            Int      @default(0) // Order within the day (if multiple articles per day)
  prerequisiteArticleIds String[] // Article IDs that must be completed first

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  article               Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, dayNumber]) // Each article can only be assigned once per day
  @@map("roadmap_assignments")
}

model ArticleProgress {
  id          String    @id @default(cuid())
  userId      String
  articleId   String
  completed   Boolean   @default(false)
  completedAt DateTime?
  lastReadAt  DateTime?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  article     Article   @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([userId, articleId])
  @@map("article_progress")
}

// Recipe Bank Models
model RecipeCategory {
  id          String   @id @default(cuid())
  name        String
  description String?
  slug        String   @unique
  orderIndex  Int      @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  recipes     Recipe[]

  @@map("recipe_categories")
}

model Recipe {
  id                  String   @id @default(cuid())
  title               String
  description         String?
  categoryId          String
  servings            Int      @default(1)
  prepTimeMinutes     Int?     // Preparation time
  cookTimeMinutes     Int?     // Cooking time
  difficulty          String?  // "easy", "medium", "hard"
  cuisineType         String?  // "Italian", "Mexican", "Asian", etc.
  mealType            String?  // "breakfast", "lunch", "dinner", "snack", "dessert"
  coverImage          String?  // URL to recipe image
  videoUrl            String?  // Optional cooking video

  // Dietary tags (stored as array)
  dietaryTags         String[] // "vegan", "vegetarian", "gluten-free", "dairy-free", "keto", "paleo", etc.

  // Nutrition per serving (can be auto-calculated from ingredients)
  caloriesPerServing  Decimal? @db.Decimal(7, 2)
  proteinPerServing   Decimal? @db.Decimal(6, 2)
  carbsPerServing     Decimal? @db.Decimal(6, 2)
  fatPerServing       Decimal? @db.Decimal(6, 2)

  // Publishing
  published           Boolean  @default(false)
  publishedAt         DateTime?

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  category            RecipeCategory       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  ingredients         RecipeIngredient[]
  instructions        RecipeInstruction[]
  favorites           RecipeFavorite[]

  @@map("recipes")
}

model RecipeIngredient {
  id              String  @id @default(cuid())
  recipeId        String
  foodItemId      String
  amount          Decimal @db.Decimal(7, 2) // Amount in grams
  displayUnit     String? // "cups", "tbsp", "tsp", "pieces", etc. for display
  displayAmount   String? // "1/2", "2", "3", etc. for display
  orderIndex      Int     @default(0)
  optional        Boolean @default(false)
  notes           String? // "chopped", "diced", "melted", etc.

  recipe          Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  foodItem        FoodItem @relation(fields: [foodItemId], references: [id])

  @@map("recipe_ingredients")
}

model RecipeInstruction {
  id          String @id @default(cuid())
  recipeId    String
  stepNumber  Int
  instruction String // Step instruction text
  duration    Int?   // Optional time for this step in minutes
  imageUrl    String? // Optional image for this step

  recipe      Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@map("recipe_instructions")
}

model RecipeFavorite {
  id        String   @id @default(cuid())
  userId    String
  recipeId  String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  recipe    Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@unique([userId, recipeId])
  @@map("recipe_favorites")
}

// Meal Plan (Kostschema) Models
model MealPlan {
  id                    String   @id @default(cuid())
  userId                String   @unique // Client this plan is for
  coachId               String?  // Coach who created the plan
  name                  String   @default("Kostschema")

  // Daily totals
  totalProtein          Decimal? @db.Decimal(6, 2)
  totalFat              Decimal? @db.Decimal(6, 2)
  totalCarbs            Decimal? @db.Decimal(6, 2)
  totalCalories         Decimal? @db.Decimal(7, 2)

  // Training supplements
  preWorkoutProtein     Decimal? @db.Decimal(5, 2)
  preWorkoutFat         Decimal? @db.Decimal(5, 2)
  preWorkoutCarbs       Decimal? @db.Decimal(5, 2)
  preWorkoutCalories    Decimal? @db.Decimal(6, 2)

  postWorkoutProtein    Decimal? @db.Decimal(5, 2)
  postWorkoutFat        Decimal? @db.Decimal(5, 2)
  postWorkoutCarbs      Decimal? @db.Decimal(5, 2)
  postWorkoutCalories   Decimal? @db.Decimal(6, 2)

  active                Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user                  User     @relation("AssignedMealPlan", fields: [userId], references: [id], onDelete: Cascade)
  meals                 MealPlanMeal[]
  supplementItems       MealPlanSupplementItem[]

  @@map("meal_plans")
}

model MealPlanMeal {
  id                    String   @id @default(cuid())
  mealPlanId            String
  mealNumber            Int      // 1, 2, 3, etc.
  name                  String?  // Optional name like "Frukost", "Lunch"

  // Meal totals
  totalProtein          Decimal? @db.Decimal(6, 2)
  totalFat              Decimal? @db.Decimal(6, 2)
  totalCarbs            Decimal? @db.Decimal(6, 2)
  totalCalories         Decimal? @db.Decimal(7, 2)

  orderIndex            Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  mealPlan              MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  items                 MealPlanItem[]

  @@map("meal_plan_meals")
}

model MealPlanItem {
  id                    String   @id @default(cuid())
  mealPlanMealId        String
  foodItemId            String?  // Can be null for custom items
  customName            String?  // For custom food items not in database
  amountG               Decimal  @db.Decimal(7, 2) // Amount in grams

  // Macros for this item (portion)
  protein               Decimal? @db.Decimal(6, 2)
  fat                   Decimal? @db.Decimal(6, 2)
  carbs                 Decimal? @db.Decimal(6, 2)
  calories              Decimal? @db.Decimal(7, 2)

  isSupplement          Boolean  @default(false) // True for Omega-3, Multivitamin, etc.
  supplementBadge       String?  // "KÖP" badge text if applicable
  notes                 String?  // "eller 37.5g naturell yoghurt 3.5% fett"

  orderIndex            Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  meal                  MealPlanMeal @relation(fields: [mealPlanMealId], references: [id], onDelete: Cascade)
  foodItem              FoodItem? @relation(fields: [foodItemId], references: [id])

  @@map("meal_plan_items")
}

model MealPlanSupplementItem {
  id                    String   @id @default(cuid())
  mealPlanId            String
  timing                String   // "pre_workout" or "post_workout"
  name                  String   // "BCAA/ EAA", "Carbs(maltodextrin)", etc.
  amountG               Decimal? @db.Decimal(7, 2) // Amount in grams
  amountUnit            String?  // "st", "g", etc.

  // Macros
  protein               Decimal? @db.Decimal(6, 2)
  fat                   Decimal? @db.Decimal(6, 2)
  carbs                 Decimal? @db.Decimal(6, 2)
  calories              Decimal? @db.Decimal(6, 2)

  supplementBadge       String?  // "KÖP" badge
  orderIndex            Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  mealPlan              MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)

  @@map("meal_plan_supplement_items")
}
